# MCP Vibe Example

**Demonstrates protoc-gen-py-mcp plugin functionality**

A self-contained example application that shows how the protoc-gen-py-mcp plugin automatically generates MCP tools from gRPC service definitions.

## What This Example Does

This application runs two servers in a single process:

1. **gRPC Server** (background thread): Implements a `VibeService` that manages server "vibe" state
2. **Generated MCP Server** (main thread): Uses **auto-generated MCP tools** created by protoc-gen-py-mcp from the proto file

**Key Point**: The MCP tools are **automatically generated** from the `.proto` file using the protoc-gen-py-mcp plugin, demonstrating the complete workflow from protobuf definitions to working MCP tools.

## Prerequisites

**⚠️ Important**: This example requires generated code to function. You must run the protoc-gen-py-mcp plugin first:

```bash
# From the main project directory
make proto
```

This generates the required files:
- `examples/gen/example/v1/example_pb2.py` (protobuf messages)
- `examples/gen/example/v1/example_pb2_grpc.py` (gRPC stubs)  
- `examples/gen/example/v1/example_pb2_mcp.py` (MCP tools - generated by our plugin!)

## Installation

```bash
# Install from the example directory
cd examples/mcp_vibe_app
pip install -e .

# Or install from PyPI (when published)
pip install mcp-vibe-example
```

## Usage

### Running the Server

```bash
# Start the integrated server
mcp-vibe

# With debug output
mcp-vibe --debug

# On a custom port
mcp-vibe --port 8080
```

### Connecting to LLM Clients

#### Claude Desktop

Add to your Claude Desktop MCP settings file (`~/Library/Application Support/Claude/claude_desktop_config.json` on macOS):

```json
{
  "mcpServers": {
    "vibe": {
      "command": "/Users/YOUR_USERNAME/Projects/protoc-gen-py-mcp/examples/mcp_vibe_example/.venv/bin/mcp-vibe"
    }
  }
}
```

**Note**: Replace `YOUR_USERNAME` with your actual username, or install globally with `pip install -e .` to use just `"command": "mcp-vibe"`

**✅ VERIFIED WORKING**: This configuration has been tested and confirmed working with Claude Desktop!

#### Other MCP Clients

The server communicates via stdio using the MCP protocol, so it should work with any MCP-compatible client.

## Example Interactions

Once connected to an LLM client, you can interact with the vibe server using natural language:

```
User: "Set the server vibe to happy"
LLM: *calls SetVibe tool with vibe="happy"*
Result: {"previous_vibe": "neutral", "current_vibe": "happy", "success": true}

User: "What's the current vibe?"
LLM: *calls GetVibe tool*
Result: {"current_vibe": "happy", "success": true}

User: "Change the mood to excited"
LLM: *calls SetVibe tool with vibe="excited"*
Result: {"previous_vibe": "happy", "current_vibe": "excited", "success": true}
```

## Architecture

```
┌─────────────────────────────────────────┐
│           mcp-vibe Process              │
│                                         │
│  ┌─────────────────┐ ┌─────────────────┐│
│  │ Background      │ │ Main Thread     ││
│  │ Thread          │ │                 ││
│  │                 │ │ FastMCP Server  ││
│  │ gRPC Server     │ │ (stdio/MCP      ││
│  │ VibeService     │ │  protocol)      ││
│  │ (localhost:     │ │                 ││
│  │  50051)         │ │ MCP Tools:      ││
│  │                 │ │ - SetVibe       ││
│  │                 │ │ - GetVibe       ││
│  └─────────────────┘ └─────────────────┘│
│           │                   │          │
│           └─── localhost ─────┘          │
└─────────────────────────────────────────┘
              │
    ┌─────────┴─────────┐
    │   LLM Client      │
    │  (Claude Desktop) │
    │   MCP Protocol    │
    └───────────────────┘
```

## Development

This example demonstrates the pattern for creating self-contained MCP applications that embed gRPC services:

1. **Embedded gRPC Server**: The gRPC service runs in a background thread
2. **MCP Tools**: FastMCP tools connect to the embedded gRPC server
3. **Single Process**: Everything runs in one executable with proper shutdown handling
4. **Error Handling**: Robust error handling and logging throughout

## Generated Code Integration

This example is based on code generated by the `protoc-gen-py-mcp` plugin from this proto definition:

```protobuf
service VibeService {
  rpc SetVibe(SetVibeRequest) returns (SetVibeResponse) {}
  rpc GetVibe(GetVibeRequest) returns (GetVibeResponse) {}
}
```

The plugin generated the MCP tool structure, which this example extends with an embedded gRPC server implementation.

## Use as Template

You can use this example as a template for your own gRPC-to-MCP integrations:

1. Replace `VibeService` with your gRPC service implementation
2. Update the protobuf imports to match your service
3. Modify the MCP tool decorators and logic as needed
4. Update packaging configuration with your service details

## Troubleshooting

### Server Won't Start
- Check if port 50051 is already in use
- Try a different port with `--port <number>`
- Enable debug mode with `--debug` for more information

### MCP Client Can't Connect
- Ensure the `mcp-vibe` command is in your PATH
- Check MCP client configuration matches the command name
- Verify the application starts without errors

### gRPC Connection Errors
- The embedded gRPC server starts automatically
- Connection retries are built-in with exponential backoff
- Check debug output for specific error messages